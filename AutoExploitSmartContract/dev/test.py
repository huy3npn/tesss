from solcx import compile_source
import json
from web3 import Web3

Provider = 'http://127.0.0.1:8545'
w3 = Web3(Web3.HTTPProvider(Provider))

solfile = 'wallet_04_confused_sign.sol'
compiled_sol = compile_source(
            open('./contracts/{name}'.format(name=solfile),'r').read(),
            solc_version="0.4.26",
            output_values=['abi', 'bin', 'opcodes', 'ast']
)

accounts = w3.eth.accounts
abi = ''
bytecode = ''

for name in compiled_sol.keys():
    abi      = compiled_sol[name]['abi']
    bytecode = compiled_sol[name]['bin']

# Hợp đồng gốc
instance = w3.eth.contract(bytecode=bytecode, abi=abi)
tx_hash             = instance.constructor().transact({'from': accounts[0]})
tx_receipt          = w3.eth.waitForTransactionReceipt(tx_hash)

# Deploy 1 instance mới dựa trên địa chỉ hợp đồng
player         = w3.eth.contract(address=tx_receipt.contractAddress, abi=abi)
player_tx_hash = player.functions.withdraw(0).transact({'from': accounts[1]})
player_tx_receipt = w3.eth.waitForTransactionReceipt(player_tx_hash)
print(player_tx_receipt)